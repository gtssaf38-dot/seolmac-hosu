<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>호수점 관리자 시스템 - 설호수 AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @font-face {
            font-family: 'Pretendard';
            src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f1f5f9;
            letter-spacing: -0.04em;
            -webkit-tap-highlight-color: transparent;
        }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .modal-backdrop {
            background-color: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(8px);
        }
        .animate-up {
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .chat-bubble {
            max-width: 85%;
            word-break: break-all;
        }
    </style>
</head>
<body class="bg-slate-100 flex justify-center">

    <div id="app" class="w-full max-w-md bg-[#F8FAFC] shadow-2xl min-h-screen relative overflow-x-hidden flex flex-col">
        <!-- JavaScript가 이 영역을 렌더링합니다 -->
    </div>

    <script>
        /**
         * GitHub Pages 배포용 설정
         * API Key는 실행 환경에서 주입되거나 빈 값으로 유지됩니다.
         */
        const apiKey = ""; 

        let state = {
            isAuthenticated: false,
            currentUser: null,
            activeTab: '홈',
            inventoryBrand: '전체',
            selectedFullDate: new Date().toISOString().split('T')[0],
            accounts: [
                { id: '6414', name: '마스터', role: '최고 관리자', color: '#4F46E5' },
                { id: 'staff1', name: '김철수', role: '직원', color: '#10B981' }
            ],
            notices: [
                { id: 1, content: '금일 주방 청소 도구 교체 예정입니다.', date: '2023-12-19', writer: '마스터' }
            ],
            workLogs: [
                { id: 101, userId: 'staff1', name: '김철수', status: '대기', workCategory: '정상근무', startTime: '11:00', endTime: '20:00', tasks: '오픈 준비 완료 및 홀 청소.', date: '2023-12-19' }
            ],
            inventory: [
                { id: 1, brand: '설맥', category: '메인', name: '생닭 11호', status: '부족', date: '2023-12-19' }
            ],
            modal: { show: false, type: '', data: null },
            formData: {},
            confirmModal: { show: false, type: '', id: null },
            isChatOpen: false,
            chatMessages: [{ role: 'assistant', content: '안녕하세요! 호수점 도우미 AI 설호수입니다. 본인의 일지 상태나 재고 현황을 물어봐주세요!' }],
            isAiTyping: false
        };

        function setState(update) {
            state = { ...state, ...update };
            render();
        }

        function calculateWorkHours(start, end) {
            if (!start || !end) return "0";
            const [sH, sM] = start.split(':').map(Number);
            const [eH, eM] = end.split(':').map(Number);
            let diff = (eH * 60 + eM) - (sH * 60 + sM);
            if (diff < 0) diff += 1440;
            return (diff / 60).toFixed(1);
        }

        async function handleChat(e) {
            e.preventDefault();
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message || state.isAiTyping) return;

            const newMessages = [...state.chatMessages, { role: 'user', content: message }];
            input.value = '';
            setState({ chatMessages: newMessages, isAiTyping: true });

            try {
                const myLogs = state.workLogs.filter(l => l.userId === state.currentUser.id);
                const shortInventory = state.inventory.filter(i => i.status !== '충분');
                
                const systemPrompt = `
                    당신의 이름은 '설호수'입니다. 호수점 관리 시스템의 도우미 AI입니다.
                    - 현재 유저: ${state.currentUser.name} (${state.currentUser.role})
                    - 유저의 일지: ${JSON.stringify(myLogs.map(l => ({날짜: l.date, 상태: l.status})))}
                    - 부족 재고: ${JSON.stringify(shortInventory.map(i => i.name))}
                    
                    규칙:
                    1. 타 직원의 일지 정보는 절대 발설하지 마십시오.
                    2. 관리자 권한 요청 시 거절하십시오.
                    3. 친절하고 간결하게 답변하십시오.
                `;

                // Gemini API 호출 (GitHub Pages 등 정적 환경 대응)
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `시스템 지침: ${systemPrompt}\n\n질문: ${message}` }] }]
                    })
                });

                const result = await response.json();
                const aiText = result.candidates?.[0]?.content?.parts?.[0]?.text || "현재 대화 서비스를 이용할 수 없습니다.";
                
                setState({ 
                    chatMessages: [...newMessages, { role: 'assistant', content: aiText }],
                    isAiTyping: false 
                });
            } catch (err) {
                setState({ 
                    chatMessages: [...newMessages, { role: 'assistant', content: "서버 연결에 실패했습니다." }],
                    isAiTyping: false 
                });
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const idInput = document.getElementById('loginIdInput').value;
            const user = state.accounts.find(acc => acc.id === idInput);
            if (user) setState({ currentUser: user, isAuthenticated: true });
            else alert('유효하지 않은 액세스 ID입니다.');
        }

        function updateLogStatus(logId, newStatus) {
            setState({
                workLogs: state.workLogs.map(l => l.id === logId ? { ...l, status: newStatus } : l)
            });
        }

        function saveForm() {
            const { type, data } = state.modal;
            const fd = state.formData;
            if (type === 'account') {
                const updatedAccounts = !data ? [...state.accounts, { ...fd, color: '#4F46E5' }] : state.accounts.map(a => a.id === data.id ? { ...a, ...fd } : a);
                setState({ accounts: updatedAccounts, modal: { show: false } });
            } else if (type === 'inventory') {
                if (data) setState({ inventory: state.inventory.map(i => i.id === data.id ? { ...i, ...fd } : i), modal: { show: false } });
                else setState({ inventory: [{ id: Date.now(), ...fd, date: state.selectedFullDate }, ...state.inventory], modal: { show: false } });
            } else if (type === 'workLog') {
                if (data) setState({ workLogs: state.workLogs.map(l => l.id === data.id ? { ...l, ...fd } : l), modal: { show: false } });
                else setState({ workLogs: [{ id: Date.now(), userId: state.currentUser.id, name: state.currentUser.name, status: '대기', ...fd, date: state.selectedFullDate }, ...state.workLogs], modal: { show: false } });
            } else if (type === 'notice') {
                if (data) setState({ notices: state.notices.map(n => n.id === data.id ? { ...n, ...fd } : n), modal: { show: false } });
                else setState({ notices: [{ id: Date.now(), ...fd, date: new Date().toISOString().split('T')[0], writer: state.currentUser.name }, ...state.notices], modal: { show: false } });
            }
        }

        function render() {
            const app = document.getElementById('app');
            if (!state.isAuthenticated) {
                app.innerHTML = renderLogin();
                return;
            }

            const isMaster = state.currentUser.role === '최고 관리자';
            let mainContent = '';
            switch (state.activeTab) {
                case '홈': mainContent = renderHome(isMaster); break;
                case '재고': mainContent = renderInventory(isMaster); break;
                case '일지': mainContent = renderWorkLogs(isMaster); break;
                case '설정': mainContent = renderSettings(isMaster); break;
            }

            app.innerHTML = `
                <header class="h-16 bg-white border-b border-slate-100 flex items-center justify-between px-6 sticky top-0 z-50">
                    <h1 class="text-sm font-black italic tracking-tighter text-indigo-600">SEOLMAC HOSU</h1>
                    <div class="flex items-center gap-3">
                        <div class="text-right">
                            <p class="text-[10px] font-black text-slate-800">${state.currentUser.name}</p>
                            <p class="text-[8px] font-bold text-indigo-500 uppercase tracking-tighter">${state.currentUser.role}</p>
                        </div>
                        <div class="w-8 h-8 rounded-xl flex items-center justify-center bg-slate-100" style="color: ${state.currentUser.color}"><i data-lucide="user" class="w-4 h-4"></i></div>
                    </div>
                </header>

                <main class="flex-grow pb-32 px-4 pt-6 space-y-8 overflow-y-auto scrollbar-hide">
                    ${mainContent}
                </main>

                <!-- AI 설호수 플로팅 버튼 -->
                <button onclick="setState({isChatOpen: !state.isChatOpen})" class="fixed bottom-24 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-2xl flex items-center justify-center z-[60] active:scale-90 transition-transform">
                    <i data-lucide="${state.isChatOpen ? 'x' : 'sparkles'}" class="w-6 h-6"></i>
                </button>

                <!-- 챗봇 창 -->
                ${state.isChatOpen ? renderChatWindow() : ''}

                <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/95 backdrop-blur-xl border-t border-slate-100 h-20 px-6 flex items-center justify-around z-50 rounded-t-[2.5rem] shadow-2xl">
                    ${['홈', '재고', '일지', '설정'].map(tab => {
                        const icons = { '홈': 'layout-dashboard', '재고': 'package', '일지': 'clipboard-list', '설정': 'settings' };
                        const isActive = state.activeTab === tab;
                        return `<button onclick="setState({activeTab:'${tab}'})" class="flex flex-col items-center gap-1.5 transition-all w-16 ${isActive ? 'text-indigo-600 scale-110' : 'text-slate-300'}">
                                <i data-lucide="${icons[tab]}" class="w-5 h-5"></i>
                                <span class="text-[8px] font-black uppercase tracking-tighter">${tab}</span>
                            </button>`;
                    }).join('')}
                </nav>

                ${state.modal.show ? renderModalView(isMaster) : ''}
                ${state.confirmModal.show ? renderConfirmView() : ''}
            `;
            lucide.createIcons();
            if (state.isChatOpen) {
                const chatContainer = document.getElementById('chatMessages');
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        function renderChatWindow() {
            return `
                <div class="fixed bottom-40 right-6 left-6 max-w-[320px] ml-auto bg-white rounded-[2rem] shadow-2xl border border-slate-100 z-[60] overflow-hidden flex flex-col animate-up" style="height: 450px;">
                    <div class="bg-indigo-600 p-4 text-white flex items-center gap-3">
                        <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i data-lucide="sparkles" class="w-4 h-4"></i></div>
                        <div><p class="text-[11px] font-black">설호수 AI</p><p class="text-[8px] opacity-70">Hosu Assistant</p></div>
                    </div>
                    <div id="chatMessages" class="flex-grow p-4 overflow-y-auto space-y-4 scrollbar-hide bg-slate-50">
                        ${state.chatMessages.map(m => `<div class="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}"><div class="chat-bubble p-3 rounded-2xl text-[11px] font-bold ${m.role === 'user' ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-white text-slate-700 shadow-sm rounded-tl-none'}">${m.content}</div></div>`).join('')}
                    </div>
                    <form onsubmit="handleChat(event)" class="p-3 bg-white border-t border-slate-100 flex gap-2">
                        <input id="chatInput" type="text" placeholder="설호수에게 물어보세요..." class="flex-grow bg-slate-50 border-none rounded-xl px-4 text-[10px] font-bold outline-none focus:ring-1 focus:ring-indigo-500" />
                        <button type="submit" class="w-10 h-10 bg-indigo-600 text-white rounded-xl flex items-center justify-center active:scale-90 transition-transform"><i data-lucide="send" class="w-4 h-4"></i></button>
                    </form>
                </div>
            `;
        }

        function renderLogin() {
            return `
                <div class="min-h-screen flex flex-col items-center justify-center p-8 bg-slate-50 text-center">
                    <div class="mb-14">
                        <h2 class="text-5xl font-black italic tracking-tighter text-indigo-600 mb-2">SEOLMAC</h2>
                        <p class="text-[9px] font-black text-slate-300 tracking-[0.5em] uppercase">Hosu Assistant</p>
                    </div>
                    <form onsubmit="handleLogin(event)" class="w-full max-w-[280px] space-y-4">
                        <input type="text" id="loginIdInput" placeholder="ACCESS ID" class="w-full h-14 bg-white rounded-2xl px-6 text-sm font-bold border border-slate-200 shadow-sm outline-none focus:ring-2 focus:ring-indigo-500" />
                        <button type="submit" class="w-full h-14 bg-indigo-600 text-white rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl active:scale-95 transition-all">Sign In</button>
                    </form>
                </div>
            `;
        }

        function renderHome(isMaster) {
            return `
                <section class="space-y-4">
                    <h4 class="px-2 text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2"><i data-lucide="megaphone" class="w-3 h-3"></i> Announcements</h4>
                    ${state.notices.map(n => `<div class="bg-slate-900 p-6 rounded-[2rem] text-white shadow-xl relative overflow-hidden"><p class="text-[12px] font-bold leading-relaxed relative z-10">${n.content}</p><div class="flex justify-between items-center mt-5 relative z-10"><p class="text-[8px] font-black text-slate-500 uppercase tracking-tighter">${n.date} · ${n.writer}</p></div></div>`).join('')}
                </section>
                <section class="bg-indigo-600 p-7 rounded-[2.5rem] shadow-xl text-white">
                    <div class="flex items-center gap-2 mb-4"><i data-lucide="sparkles" class="w-4 h-4 text-indigo-200"></i><span class="text-[10px] font-black uppercase tracking-[0.2em]">Quick Status Guide</span></div>
                    <p class="text-[13px] font-bold leading-relaxed">설호수 AI에게 일지 승인 여부나 재고 현황을 물어보세요!</p>
                </section>
            `;
        }

        function renderInventory(isMaster) {
            const filtered = state.inventory.filter(i => (state.inventoryBrand === '전체' || i.brand === state.inventoryBrand));
            return `
                <div class="flex justify-between items-center px-2">
                    <h2 class="text-xl font-black italic text-slate-800 uppercase tracking-tighter">Inventory</h2>
                    <button onclick="openModal('inventory')" class="px-5 py-2.5 bg-indigo-600 text-white rounded-xl text-[10px] font-black shadow-lg">+ Add</button>
                </div>
                <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-2">
                    ${['전체', '설맥', '아임타코'].map(b => `<button onclick="setState({inventoryBrand:'${b}'})" class="px-6 py-3 rounded-full text-[10px] font-black transition-all whitespace-nowrap ${state.inventoryBrand === b ? 'bg-slate-900 text-white shadow-xl' : 'bg-white text-slate-400 border border-slate-100'}">${b}</button>`).join('')}
                </div>
                <div class="space-y-3 px-1">
                    ${filtered.map(item => `
                        <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-4">
                                    <div class="w-1.5 h-10 rounded-full ${item.brand === '설맥' ? 'bg-indigo-400' : 'bg-rose-400'}"></div>
                                    <div><p class="text-[12px] font-black text-slate-800">${item.name}</p><p class="text-[8px] font-black text-slate-300 mt-1 uppercase">${item.brand}</p></div>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <div class="flex gap-2">
                                    ${isMaster && item.status !== '충분' ? `<button onclick="setState({inventory: state.inventory.map(i=>i.id===${item.id}?{...i,status:'충분'}:i)})" class="px-4 py-2 bg-slate-900 text-white rounded-xl text-[9px] font-black uppercase">해결됨</button>` : '<div class="w-20"></div>'}
                                </div>
                                <span class="px-3 py-1.5 rounded-lg text-[9px] font-black border ${item.status === '충분' ? 'bg-emerald-50 text-emerald-500 border-emerald-100' : 'bg-amber-50 text-amber-500 border-amber-100'}">${item.status}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderWorkLogs(isMaster) {
            const logsForDate = state.workLogs.filter(l => l.date === state.selectedFullDate && (isMaster || l.userId === state.currentUser.id));
            return `
                <div class="flex justify-between items-center px-2">
                    <h2 class="text-xl font-black italic text-slate-800 uppercase tracking-tighter">Work Logs</h2>
                    <button onclick="openModal('workLog')" class="px-5 py-2.5 bg-slate-900 text-white rounded-xl text-[10px] font-black">+ New</button>
                </div>
                <div class="px-2"><input type="date" value="${state.selectedFullDate}" onchange="setState({selectedFullDate:this.value})" class="w-full h-12 bg-white rounded-2xl px-6 text-[10px] font-black border border-slate-100" /></div>
                <div class="space-y-6">
                    ${logsForDate.map(log => `
                        <div class="bg-white p-7 rounded-[2.5rem] border border-slate-100 shadow-sm">
                            <div class="flex justify-between items-start mb-6">
                                <div class="flex items-center gap-4">
                                    <div class="w-10 h-10 rounded-xl flex items-center justify-center font-black text-sm" style="background-color: ${log.userId === '6414' ? '#4F46E515' : '#10B98115'}; color: ${log.userId === '6414' ? '#4F46E5' : '#10B981'}">${log.name[0]}</div>
                                    <div><p class="text-[13px] font-black text-slate-800">${log.name}</p><p class="text-[9px] font-bold text-slate-400 mt-1">${log.workCategory}</p></div>
                                </div>
                            </div>
                            <div class="bg-slate-50 p-5 rounded-2xl text-[12px] font-bold text-slate-600 leading-relaxed mb-6">${log.tasks}</div>
                            ${isMaster && log.status === '대기' ? `
                                <div class="grid grid-cols-2 gap-2 mb-6">
                                    <button onclick="updateLogStatus(${log.id}, '거절')" class="h-10 bg-slate-100 text-slate-500 rounded-xl text-[9px] font-black uppercase">Reject</button>
                                    <button onclick="updateLogStatus(${log.id}, '승인')" class="h-10 bg-indigo-600 text-white rounded-xl text-[9px] font-black uppercase shadow-lg">Approve</button>
                                </div>
                            ` : ''}
                            <div class="flex justify-between items-center pt-5 border-t border-slate-50">
                                <span class="text-[10px] font-black text-slate-400 uppercase tracking-tighter">${log.startTime} - ${log.endTime}</span>
                                <span class="px-2.5 py-1.5 rounded-lg text-[9px] font-black border ${log.status === '승인' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' : 'bg-amber-50 text-amber-600 border-amber-100'}">${log.status}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderSettings(isMaster) {
            return `
                <div class="bg-white p-10 rounded-[3.5rem] border border-slate-100 shadow-sm text-center">
                    <div class="w-20 h-20 rounded-[2rem] flex items-center justify-center font-black text-2xl mx-auto mb-6" style="background-color: ${state.currentUser.color}15; color: ${state.currentUser.color}">${state.currentUser.name[0]}</div>
                    <h3 class="text-xl font-black text-slate-800">${state.currentUser.name}</h3>
                    <p class="text-[9px] font-black text-slate-300 mb-4 tracking-widest uppercase">ID: ${state.currentUser.id}</p>
                    <span class="px-5 py-2 rounded-full text-[9px] font-black text-white uppercase tracking-widest shadow-lg" style="background-color: ${state.currentUser.color}">${state.currentUser.role}</span>
                </div>
                <button onclick="setState({isAuthenticated:false})" class="w-full h-18 bg-white border border-rose-100 rounded-[2.5rem] flex items-center justify-between px-8 text-rose-500 shadow-sm active:scale-95 transition-all mt-10">
                    <div class="flex items-center gap-4"><i data-lucide="log-out" class="w-5 h-5"></i> <span class="text-xs font-black uppercase tracking-widest">Sign Out</span></div>
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>
            `;
        }

        function renderModalView(isMaster) {
            const { type, data } = state.modal;
            const fd = state.formData;
            return `
                <div class="fixed inset-0 z-[100] flex items-end modal-backdrop">
                    <div class="bg-white w-full max-w-md mx-auto rounded-t-[3.5rem] p-10 shadow-2xl animate-up">
                        <div class="w-12 h-1 bg-slate-100 rounded-full mx-auto mb-8"></div>
                        <div class="flex justify-between items-center mb-8"><h3 class="text-xs font-black italic text-slate-800 uppercase">${type}</h3><button onclick="setState({modal:{show:false}})" class="p-2 bg-slate-50 rounded-xl text-slate-300"><i data-lucide="x" class="w-5 h-5"></i></button></div>
                        <div class="space-y-5 pb-8 overflow-y-auto max-h-[60vh] scrollbar-hide">
                            ${type === 'inventory' ? `<input type="text" placeholder="Item Name" oninput="updateFormData('name', this.value)" class="w-full h-12 bg-slate-50 px-5 rounded-2xl text-[11px] font-bold border border-slate-100" />` : ''}
                            ${type === 'workLog' ? `<textarea placeholder="Task Details" oninput="updateFormData('tasks', this.value)" class="w-full bg-slate-50 p-6 rounded-2xl text-[11px] font-bold min-h-[140px] border border-slate-100"></textarea>` : ''}
                            <button onclick="saveForm()" class="w-full h-14 bg-indigo-600 text-white rounded-[1.5rem] font-black text-[11px] uppercase shadow-lg active:scale-95 mt-4">Save</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderConfirmView() {
            return `<div class="fixed inset-0 z-[200] flex items-center justify-center modal-backdrop px-10"><div class="bg-white w-full max-w-[300px] rounded-[3rem] p-8 text-center shadow-2xl"><h4 class="text-md font-black text-slate-800 mb-2">Delete?</h4><p class="text-[10px] font-bold text-slate-400 mb-8">정말 삭제하시겠습니까?</p><div class="grid grid-cols-2 gap-3"><button onclick="setState({confirmModal:{show:false}})" class="h-12 bg-slate-100 text-slate-400 rounded-xl text-[10px] font-black">취소</button><button onclick="deleteItem()" class="h-12 bg-rose-500 text-white rounded-xl text-[10px] font-black shadow-lg">삭제</button></div></div></div>`;
        }

        function deleteItem() {
            const { type, id } = state.confirmModal;
            if (type === 'inventory') setState({ inventory: state.inventory.filter(i => i.id !== id), confirmModal: { show: false } });
            if (type === 'workLog') setState({ workLogs: state.workLogs.filter(l => l.id !== id), confirmModal: { show: false } });
            setState({ confirmModal: { show: false } });
        }

        window.openModal = function(type, data = null) {
            const formData = data ? { ...data } : { name: '', brand: '설맥', status: '부족', tasks: '', startTime: '11:00', endTime: '20:00' };
            setState({ modal: { show: true, type, data }, formData });
        };

        window.updateFormData = function(key, val) { state.formData[key] = val; };

        // 초기 실행
        render();
    </script>
</body>
</html>
